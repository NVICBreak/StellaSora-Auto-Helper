<!--
 #     #                #####   #####  
 ##   ##   ##     ##   #     # #     # 
 # # # #  #  #   #  #  #       #       
 #  #  # #    # #    #  #####   #####  
 #     # ###### ######       #       # 
 #     # #    # #    # #     # #     # 
 #     # #    # #    #  #####   #####  
-->

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaaStellaSora - 星塔助手</title>
    <link rel="shortcut icon" href="logo.png" type="image/x-icon">
    <meta name="msvalidate.01" content="AF3CE7FF7640F168AE1F7F33798842E8" />
    <style>
        /* ================= 全局变量与重置 ================= */
        :root {
            --primary-color: #007AFF;
            --primary-hover: #0066d6;
            --bg-color: #f5f7fa;
            --text-main: #1d1d1f;
            --text-secondary: #86868b;
            --glass-border: rgba(255, 255, 255, 0.6);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 30px 60px rgba(0, 0, 0, 0.12);
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans SC", sans-serif;
            color: var(--text-main);
            background-color: var(--bg-color);
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.5;
        }

        /* ================= 右上角 GitHub 悬浮按钮 ================= */
        .github-stats-btn {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 8px 16px;
            border-radius: 24px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            text-decoration: none;
            color: #24292e;
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            cursor: pointer;
        }

        .github-stats-btn:hover {
            background: white;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .star-num {
            background: #f0f2f5;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            color: #24292e;
            min-width: 24px;
            text-align: center;
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }

        /* ================= 动态背景 Canvas ================= */
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 50% 0%, #ffffff, #f0f4f8 80%);
        }

        /* ================= 主要内容区域 ================= */
        main {
            flex: 1;
            width: 100%;
            padding: 120px 5% 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        /* Hero 容器 */
        .hero-container {
            max-width: 1200px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 60px;
            margin-bottom: 80px;
            /* 为下方的预览图留出空间 */
        }

        /* 左侧文本区域 */
        .hero-content {
            flex: 1;
            opacity: 0;
            transform: translateY(20px);
            animation: slideUpFade 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards 0.2s;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            background: rgba(0, 122, 255, 0.08);
            color: var(--primary-color);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 24px;
            border: 1px solid rgba(0, 122, 255, 0.15);
            letter-spacing: 0.5px;
        }

        .title-wrapper {
            margin-bottom: 24px;
        }

        .main-title {
            font-size: 3.8rem;
            font-weight: 800;
            line-height: 1.05;
            letter-spacing: -1.5px;
            margin: 0;
            letter-spacing: -0.02em;
        }

        .title-en {
            color: var(--text-main);
            display: block;
            margin-bottom: 2px;
        }

        .title-cn {
            background: linear-gradient(135deg, #007AFF 0%, #00C6FF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: block;
        }

        .description {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 40px;
            max-width: 520px;
            line-height: 1.6;
            font-weight: 400;
        }

        .btn-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 36px;
            border-radius: 16px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn i {
            margin-right: 10px;
            font-size: 1.1em;
        }

        /* 主下载按钮优化 */
        .btn-primary {
            background-color: #1d1d1f;
            color: white;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .btn-primary:hover {
            background-color: #000;
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Mirror 按钮优化 */
        .btn-outline {
            background-color: rgba(255, 255, 255, 0.5);
            color: var(--text-main);
            border: 2px solid rgba(0, 0, 0, 0.08);
        }

        .btn-outline:hover {
            background-color: white;
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }

        /* 右侧 Logo 区域 */
        .hero-image {
            flex: 1;
            display: flex;
            justify-content: flex-end;
            position: relative;
            z-index: 2;
            opacity: 0;
            animation: fadeIn 1s ease-out forwards 0.5s;
        }

        .character-wrapper {
            position: relative;
            width: 100%;
            max-width: 480px;
            animation: float 6s ease-in-out infinite;
        }

        .character-img {
            width: 100%;
            height: auto;
            filter: drop-shadow(0 25px 35px rgba(0, 0, 0, 0.15));
            object-fit: contain;
        }

        .decoration-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 122, 255, 0.06) 0%, rgba(255, 255, 255, 0) 70%);
            z-index: -1;
            pointer-events: none;
        }

        /* ================= 软件预览区域 (新增) ================= */
        .preview-section {
            width: 100%;
            max-width: 1100px;
            opacity: 0;
            animation: slideUpFade 1s cubic-bezier(0.2, 0.8, 0.2, 1) forwards 0.8s;
            /* 延迟出现 */
        }

        .preview-container {
            width: 100%;
            background: white;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            position: relative;
        }

        .preview-img {
            width: 100%;
            height: auto;
            display: block;
            /* 避免图片加载时的闪烁，给个背景色 */
            background-color: #f0f0f0;
        }

        /* ================= Toast 提示框 ================= */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 14px 28px;
            border-radius: 50px;
            font-size: 0.95rem;
            z-index: 2000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(4px);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* ================= 关键帧动画 ================= */
        @keyframes float {
            0% {
                transform: translateY(0px) rotate(0deg);
            }

            50% {
                transform: translateY(-15px) rotate(1deg);
            }

            100% {
                transform: translateY(0px) rotate(0deg);
            }
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(40px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ================= 响应式调整 ================= */
        @media (max-width: 1024px) {
            .hero-container {
                flex-direction: column-reverse;
                text-align: center;
                gap: 40px;
            }

            .hero-content {
                align-items: center;
            }

            .hero-image {
                justify-content: center;
                width: 70%;
            }

            .title-wrapper {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 768px) {
            main {
                padding-top: 100px;
                padding-bottom: 60px;
            }

            .main-title {
                font-size: 2.5rem;
            }

            .description {
                font-size: 1.1rem;
            }

            .github-stats-btn {
                top: 16px;
                right: 16px;
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .github-stats-btn span:not(.star-num) {
                display: none;
            }

            .preview-section {
                margin-top: 20px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <a href="https://github.com/MaaStellaSora/MaaStellaSora" target="_blank" class="github-stats-btn">
        <i class="fa-brands fa-github"></i>
        <span>Star</span>
        <span id="star-count" class="star-num">...</span>
    </a>

    <canvas id="bg-canvas"></canvas>

    <main>
        <!-- Hero 区域 -->
        <div class="hero-container">
            <div class="hero-content">
                <span class="hero-badge" id="versionBadge">Loading...</span>

                <div class="title-wrapper">
                    <h1 class="main-title title-en">MaaStellaSora</h1>
                    <h2 class="main-title title-cn">星塔助手</h2>
                </div>

                <p class="description">
                    星塔助手（MaaStellaSora）提供对于游戏《星塔旅人》的自动签到、清理日常等功能，由 MaaFramework 强力驱动
                </p>

                <div class="btn-group">
                    <a href="#" class="btn btn-primary" id="githubDownloadBtn">
                        <i class="fa-brands fa-github"></i> <span id="downloadText">下载中...</span>
                    </a>
                    <a href="https://mirrorchyan.com/zh/projects?rid=SSAH&os=windows&arch=x64&channel=stable"
                        target="_blank" class="btn btn-outline">
                        <i class="fa-solid fa-cloud-arrow-down"></i> Mirror酱下载
                    </a>
                </div>
            </div>

            <div class="hero-image">
                <div class="character-wrapper">
                    <div class="decoration-circle"></div>
                    <!-- 这里的 logo.png 请确保路径正确 -->
                    <img src="logo.png" alt="MaaStellaSora Logo" class="character-img">
                </div>
            </div>
        </div>

        <!-- 软件预览区域 (新增) -->
        <div class="preview-section">
            <div class="preview-container">
                <!-- 请替换 src 为您的软件截图路径，例如 preview.png -->
                <!-- 如果没有图片，这里显示一个占位符 -->
                <img src="preview.png" alt="MaaStellaSora Preview" class="preview-img"
                    onerror="this.style.display='none'">
            </div>
        </div>

    </main>

    <div class="toast" id="toast">
        <i class="fa-solid fa-circle-info"></i>
        <span id="toastMsg">Notification</span>
    </div>

    <script>
        // ================= 配置与状态 =================
        const DEFAULT_VERSION = 'v0.7.7-fix-1';
        let currentVersion = DEFAULT_VERSION;

        const CONFIG = {
            repo: 'MaaStellaSora/MaaStellaSora',
        };

        // ================= 1. 初始化 UI (使用固定版本) =================
        function initUI() {
            document.getElementById('versionBadge').textContent = currentVersion;
            updateGithubButton();
        }

        // ================= 2. 获取仓库 Star 数 =================
        async function fetchRepoStats() {
            try {
                const response = await fetch(`https://api.github.com/repos/${CONFIG.repo}`);
                if (!response.ok) throw new Error('Repo API failed');

                const data = await response.json();
                const stars = data.stargazers_count;

                document.getElementById('star-count').textContent = stars;
            } catch (error) {
                console.warn('Failed to fetch repo stats:', error);
                document.getElementById('star-count').textContent = '-';
            }
        }

        // ================= 3. Github 下载链接构建逻辑 =================
        function getDownloadInfo(version) {
            const userAgent = navigator.userAgent;
            const platform = navigator.platform;

            let os = 'unknown';
            let arch = 'x86_64';
            let ext = '';
            let label = '';
            let isSupported = true;

            if (platform.indexOf('Mac') !== -1 || userAgent.indexOf('Mac') !== -1) {
                os = 'macos';
                ext = 'tar.gz';
                label = 'macOS';
                if (platform === 'MacARM' || (typeof navigator.userAgentData !== 'undefined' && navigator.userAgentData.platform === 'macOS' && navigator.userAgentData.architecture === 'arm')) {
                    arch = 'aarch64';
                    label = 'macOS (Apple Silicon)';
                }
            } else if (platform.indexOf('Win') !== -1) {
                os = 'win';
                ext = 'zip';
                label = 'Windows';
            } else if (platform.indexOf('Linux') !== -1 || userAgent.indexOf('Linux') !== -1) {
                os = 'linux';
                ext = 'tar.gz';
                label = 'Linux';
            } else if (/Android/.test(userAgent) || /iPhone|iPad|iPod/.test(userAgent)) {
                os = 'mobile';
                isSupported = false;
            }

            const baseUrl = `https://gh-proxy.com/https://github.com/${CONFIG.repo}/releases/download/${version}`;
            const fileName = `MaaStellaSora-${os}-${arch}-${version}.${ext}`;
            const fullUrl = `${baseUrl}/${fileName}`;

            return { os, arch, label, isSupported, fullUrl, fileName };
        }

        function updateGithubButton() {
            const btn = document.getElementById('githubDownloadBtn');
            const info = getDownloadInfo(currentVersion);

            if (!info.isSupported) {
                btn.onclick = (e) => {
                    e.preventDefault();
                    showToast('请使用 PC 端访问以下载软件', 'warning');
                };
                btn.style.backgroundColor = '#666';
                btn.style.opacity = '0.7';
                document.getElementById('downloadText').textContent = '不支持当前系统';
                return;
            }

            const textSpan = document.getElementById('downloadText');
            textSpan.textContent = `立即从 Github 下载 (${info.label})`;

            btn.href = info.fullUrl;
            btn.setAttribute('download', info.fileName);
            btn.removeAttribute('onclick');

            btn.addEventListener('click', (e) => {
                showToast(`正在跳转下载: ${info.fileName}...`);
            });
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toastMsg');

            msg.textContent = message;
            toast.classList.add('show');

            if (type === 'warning') toast.style.background = 'rgba(255, 167, 38, 0.9)';
            else toast.style.background = 'rgba(0,0,0,0.85)';

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ================= 4. Canvas 背景动效 =================
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let particles = [];
        const gridSpacing = 60;
        const gridSpeed = 0.5;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        class Particle {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.size = Math.random() * 3 + 1;
                this.alpha = Math.random() * 0.5 + 0.1;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                if (this.x < 0) this.x = width;
                if (this.x > width) this.x = 0;
                if (this.y < 0) this.y = height;
                if (this.y > height) this.y = 0;
            }

            draw() {
                ctx.fillStyle = `rgba(0, 122, 255, ${this.alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            const count = Math.floor(width * height / 20000);
            for (let i = 0; i < count; i++) {
                particles.push(new Particle());
            }
        }

        let offset = 0;

        function animate() {
            ctx.clearRect(0, 0, width, height);
            ctx.strokeStyle = 'rgba(0, 122, 255, 0.06)'; /* 降低网格线透明度，使其更精致 */
            ctx.lineWidth = 1;
            offset = (offset + gridSpeed) % gridSpacing;

            for (let x = offset; x < width; x += gridSpacing) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            for (let y = 0; y < height; y += gridSpacing) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animate);
        }

        // ================= 初始化流程 =================
        window.addEventListener('resize', () => {
            resize();
            initParticles();
        });

        resize();
        initParticles();
        animate();

        initUI();
        fetchRepoStats();

    </script>
</body>

</html>